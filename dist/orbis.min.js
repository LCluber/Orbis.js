/** MIT License
* 
* Copyright (c) 2011 Ludovic CLUBER 
* 
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in all
* copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
*
* http://orbisjs.lcluber.com
*/
var ORBIS={revision:"0.4.6",assets:{},assetsPath:"",requests:{},requestsLength:0,sentRequests:0,onProgress:function(){},onComplete:function(){},progress:{},pending:0,tick:0,maxPending:0,defaultMaxPending:6,defaultTick:100,logs:{},create:function(a,b,c,d,e){var f=Object.create(this);return f.logs=ORBIS.Logger.create(),f.logs.init(),ORBIS.Utils.isFunction(a)?f.onProgress=a:f.logs.add("onProgress parameter is not a function"),ORBIS.Utils.isFunction(c)?f.onComplete=c:f.logs.add("onComplete parameter is not a function"),f.progress=ORBIS.Progress.create(b),f.setTick(d),f.setMaxPending(e),f},launch:function(a,b){this.progress.init(),this.assetsPath=ORBIS.Utils.removeTrailingSlash(b),this.assets.fsm&&"success"===this.assets.fsm.getStatus()?(this.logs.add(a+" already loaded."),this.onAssetsFileLoaded("success",this.assets.response,this)):(this.logs.add("create request for "+a),this.assets=ORBIS.Request.create(a,"file","",this.onAssetsFileLoaded,this),this.assets?this.assets.send():this.logs.add('!! the config file must be of type "file"'))},onAssetsFileLoaded:function(a,b,c){if("success"==a){c.logs.add("parsing asset file"),c.requestsLength=0,c.sentRequests=0;for(var d in b.json)if(b.json.hasOwnProperty(d))for(var e=b.json[d],f=e.files,g=e.folder?e.folder+"/":"",h=0;h<f.length;h++){var i=f[h],j=i.hasOwnProperty("file")?i.file:i,k=c.assetsPath+"/"+g+j;if(c.getAsset(j))c.logs.add(k+" already loaded.");else{var l=ORBIS.Request.create(k,"",i,c.onFileLoaded,c);"string"!=typeof l.file?(c.logs.add("create request for "+k),c.requests[j]=l,c.requestsLength++):c.logs.add(l.file)}}c.logs.add(c.requestsLength+" requests to perform"),c.sendRequest()}else c.logs.add("!! error during config file AJAX request")},sendRequest:function(){if(this.pending<this.maxPending){var a=Object.keys(this.requests)[this.sentRequests];(this.getAsset(a)||"error"==this.requests[a].send())&&this.updateProgress(0,this.getAsset(a).response),this.pending++,this.sentRequests++}this.sentRequests<this.requestsLength&&setTimeout(this.loadAnotherFile.bind(this),this.tick)},loadAnotherFile:function(){this.sendRequest()},onFileLoaded:function(a,b,c){c.updateProgress(a,b)},updateProgress:function(a,b){var c=this.progress.update(a,this.requestsLength);this.pending>0&&this.pending--,this.logs.add("progress "+this.progress.target+"%"),this.onProgress(this.progress.target,b),c||(this.logs.add("loading complete"),this.onComplete(this.getLogs()))},getList:function(a){if(this.assets.response.json.hasOwnProperty(a)){for(var b=[],c=this.assets.response.json[a].files,d=0;d<c.length;d++){var e=this.getAsset(c[d]);e&&b.push(e)}return b}return!1},getAsset:function(a){return!(!this.requests[a]||"success"!==this.requests[a].fsm.getStatus())&&this.requests[a]},setScope:function(a){return!!ORBIS.Utils.isObject(a)&&(this.onProgress=this.onProgress.bind(a),this.progress.onAnimate=this.progress.onAnimate.bind(a),this.onComplete=this.onComplete.bind(a),void 0)},getTick:function(){return this.tick},setTick:function(a){this.tick=ORBIS.Utils.valueValidation(a)?ORBIS.Utils.valueValidation(a):this.defaultTick},getMaxPending:function(){return this.maxPending},setMaxPending:function(a){this.maxPending=ORBIS.Utils.valueValidation(a)?ORBIS.Utils.valueValidation(a):this.defaultMaxPending},getLogs:function(){return this.logs.get()},setProgressSpeed:function(a){return this.progress.speed=ORBIS.Utils.clamp(ORBIS.Utils.valueValidation(a),10,100),this.progress.speed}};ORBIS.Logger={logs:"",create:function(){var a=Object.create(this);return a},init:function(){this.logs=""},get:function(){return this.logs},add:function(a){this.logs+=a+"\n"}},ORBIS.File={path:"",directory:"",name:"",extension:"",type:"",extensions:{file:["txt","text","json","babylon"],image:["png","jpg","jpeg","gif"],sound:["mp3","ogg","wav"]},create:function(a,b){var c=Object.create(this);c.path=a,c.extractExtension();var d=c.checkExtension(b);return d===!0?(c.extractDirectory(),c.extractName(),c):d},getPath:function(){return this.path},getName:function(){return this.name},getExtension:function(){return this.extension},getType:function(){return this.type},extractName:function(){this.name=!!this.path&&this.path.replace(/^.*[\\\/]/,"")},extractDirectory:function(){this.directory=!!this.path&&this.path.replace(/[^\\\/]*$/,"")},extractExtension:function(){this.extension=!!this.path&&this.path.split(".").pop()},checkExtension:function(a){for(var b in this.extensions)if(this.extensions.hasOwnProperty(b)&&(!a||a==b))for(var c=0;c<this.extensions[b].length;c++)if(this.extensions[b][c]==this.extension)return this.type=b,!0;return'Invalid file extension for "'+this.path+'"'}},ORBIS.AjaxRequest=function(a,b,c,d){var e=new XMLHttpRequest;c&&(a+="?cache="+(new Date).getTime()),e.open("GET",a,b),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){4==this.readyState&&200==this.status&&d(this.responseText)},e.send()},ORBIS.Utils={getFileName:function(a){return!!a&&a.replace(/^.*[\\\/]/,"")},removeTrailingSlash:function(a){return!!a&&a.replace(/\/+$/,"")},valueValidation:function(a){return isNaN(a)?0:Math.abs(Math.round(a))},clamp:function(a,b,c){return Math.min(Math.max(a,b),c)},isJSON:function(a){var b=a.replace(/(\r\n|\n|\r|\t)/gm,"");try{b=JSON.parse(a)}catch(c){return!1}return b},isFunction:function(a){var b={};return a&&"[object Function]"===b.toString.call(a)},isObject:function(a){return null!==a&&(this.isFunction(a)||"object"==typeof a)}},ORBIS.LoadImage=function(a,b,c){var d=new Image;return d.src=a,d.name=ORBIS.Utils.getFileName(a),d.addEventListener("load",function(){b(1,c)},!1),d.addEventListener("error",function(){b(0,c)},!1),d},ORBIS.LoadSound=function(a,b,c){var d=new Audio;return d.src=a,d.name=ORBIS.Utils.getFileName(a),d.addEventListener("canplaythrough",function(){b(1,c)},!1),d.addEventListener("canplay",function(){b(1,c)},!1),d.addEventListener("error",function(){b(0,c)},!1),d},ORBIS.LoadFile=function(a,b,c){var d={};return d.src=a,d.name=ORBIS.Utils.getFileName(a),d.data="",d.json="",ORBIS.AjaxRequest(a,!0,1,function(a){a&&(d.data=a,d.json=ORBIS.Utils.isJSON(a)),b(a?1:0,c)}),d},ORBIS.Progress={rate:0,percentage:0,target:0,speed:40,success:0,error:0,total:0,animation:{},onAnimate:function(){},create:function(a){var b=Object.create(this);return b.animation=FRAMERAT.create(b.animate,b),ORBIS.Utils.isFunction(a)&&(b.onAnimate=a),b},init:function(){this.rate=0,this.percentage=0,this.target=0,this.success=0,this.error=0,this.total=0},update:function(a,b){return a?this.onSuccess():this.onError(),this.total++,this.rate=b?this.total/b:1,this.target=Math.round(100*this.rate),this.animation.play(),this.checkComplete()},animate:function(){this.percentage+=this.speed*this.animation.getDelta(),this.percentage>=this.target?(this.percentage=this.target,this.animation.stop()):this.animation.newFrame(),this.onAnimate(this.percentage)},onSuccess:function(){this.success++},onError:function(){this.error++},checkComplete:function(){return!(this.rate>=1)}},ORBIS.Request={file:{},response:{},fsm:{},callback:{method:function(){},scope:{}},json:{},loaders:{file:"LoadFile",image:"LoadImage",sound:"LoadSound"},logs:{},create:function(a,b,c,d,e){var f=Object.create(this);return f.logs=e.logs,f.createFile(a,b),"string"==typeof this.file?this.file:(f.createCallback(d,e),f.createFSM(),f.addInfo(c),f)},createFile:function(a,b){this.file=ORBIS.File.create(a,b)},createCallback:function(a,b){this.callback={},this.callback.method=a,this.callback.scope=b},createFSM:function(){this.fsm=TAIPAN.create([{name:"send",from:"idle",to:"pending"},{name:"success",from:"pending",to:"success"},{name:"error",from:"pending",to:"error"}])},addInfo:function(a){if(a.hasOwnProperty("file")){this.json={};for(var b in a)a.hasOwnProperty(b)&&"file"!==b&&(this.json[b]=a[b])}},send:function(){return this.logs.add("send "+this.file.getName()+", Status "+this.fsm.getStatus()),this.fsm.send(),this.file.getType()?this.response=ORBIS[this.loaders[this.file.getType()]](this.file.path,this.onComplete,this):(this.fsm.error(),this.logs.add("!! invalid file type. Cannot load "+this.file.path+". Status "+this.fsm.getStatus())),this.fsm.getStatus()},onComplete:function(a,b){var c=!1;a?c=b.fsm.success():(c=b.fsm.error(),b.logs.add("!! error during AJAX request for : "+b.file.path+".")),c&&(b.logs.add("complete "+b.file.getName()+". Status "+b.fsm.getStatus()),b.callback.method(b.fsm.getStatus(),b.response,b.callback.scope))}};
var FRAMERAT={revision:"0.2.5",id:null,onAnimate:function(){},tickCount:0,fsm:{},clock:{},frameId:0,options:{refreshRate:30},console:{},formated:{delta:0},create:function(a,b){var c=Object.create(this);return c.createOnAnimateCallback(a,b),c.createFiniteStateMachine(),c.createConsole(),c.clock=FRAMERAT.Clock.create(),c},createOnAnimateCallback:function(a,b){b?this.onAnimate=a.bind(b):this.onAnimate=a},createConsole:function(){this.console=FRAMERAT.Console.create(TYPE6.Vector2D.create(),TYPE6.Vector2D.create(20,20)),this.console.addLine("Elapsed time : {0}",this.getFormatedTotalTime,this),this.console.addLine("Frame count : {0}",this.getFrameNumber,this),this.console.addLine("Frame Per Second : {0}",this.getFramePerSecond,this),this.console.addLine("Frame duration : {0}",this.getFormatedDelta,this),this.toggleConsole()},createFiniteStateMachine:function(){this.fsm=TAIPAN.create([{name:"play",from:"paused",to:"running"},{name:"pause",from:"running",to:"paused"}])},play:function(){return!!this.fsm.play()&&(this.clock.start(),this.requestNewFrame(),!0)},pause:function(){return!!this.fsm.pause()&&(this.cancelAnimation(),!0)},toggle:function(){return this.play()||this.pause(),this.fsm.getStatus()},stop:function(){return!!this.pause()&&(this.clock.init(),this.tickCount=0,!0)},getTotalTime:function(){return this.clock.getTotal()},getFormatedTotalTime:function(){return TYPE6.MathUtils.round(this.millisecondToSecond(this.getTotalTime()),2)},getDelta:function(){return this.millisecondToSecond(this.clock.getDelta())},getFormatedDelta:function(){return this.tickCount%this.options.refreshRate===0&&(this.formated.delta=TYPE6.MathUtils.round(this.getDelta(),5)),this.formated.delta},getFrameNumber:function(){return this.tickCount},getFramePerSecond:function(){return this.tickCount%this.options.refreshRate===0&&this.clock.computeFramePerSecond(),this.clock.getFramePerSecond()},newFrame:function(){this.requestNewFrame(),this.clock.tick()},requestNewFrame:function(){this.frameId=window.requestAnimationFrame(this.onAnimate),this.tickCount++},cancelAnimation:function(){window.cancelAnimationFrame(this.frameId)},millisecondToSecond:function(a){return.001*a},drawConsole:function(a){this.console.draw(a)},toggleConsole:function(){this.console.toggle()}};FRAMERAT.Console={fontFamily:"Georgia",fontSize:20,fontColor:"rgba(60, 60, 60, 1)",font:"",position:null,padding:null,color:null,lineHeight:30,lines:[],nbLines:0,show:!1,create:function(a,b){var c=Object.create(this);return c.position=a,c.padding=b,c.lines=[],c.setFont(c.fontSize,c.fontFamily),c},setFont:function(a,b){this.font=a+"px "+b},setFontColor:function(a,b,c,d){this.fontColor="rgba("+a+", "+b+", "+c+", "+d+")"},addLine:function(a,b,c){var d=this.lineHeight,e=this.padding.getX();d+=this.nbLines?this.lines[this.nbLines-1].position.getY():this.padding.getY(),this.nbLines++;var f=this.Line.create(TYPE6.Vector2D.create(e,d),a,b,c);this.lines.push(f)},draw:function(a){if(this.show){a.font=this.font,a.fillStyle=this.fontColor;for(var b=0;b<this.nbLines;b++){var c=this.lines[b];this.write(c.text.replace("{0}",c.callback),c.position,a)}}},write:function(a,b,c){c.fillText(a,b.getX(),b.getY())},toggle:function(){this.show=!this.show}},FRAMERAT.Console.Line={position:null,callback:null,text:"",create:function(a,b,c,d){var e=Object.create(this);return e.position=a,e.callback=c.bind(d),e.text=b,e}},FRAMERAT.Clock={old:performance.now(),"new":performance.now(),fps:0,minimumTick:16,total:0,delta:0,create:function(){var a=Object.create(this);return a.init(),a},init:function(){this.fps=0,this.total=0,this.delta=Math.max(0,this.minimumTick)},start:function(){this.old=performance.now()},tick:function(){this["new"]=performance.now(),this.delta=Math.max(this["new"]-this.old,this.minimumTick),this.old=this["new"],this.total+=this.delta},getTotal:function(){return this.total},getDelta:function(){return this.delta},computeFramePerSecond:function(){this.fps=Math.round(1e3/this.delta)},getFramePerSecond:function(){return this.fps}},function(){if("performance"in window==!1&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==!1){var a=Date.now();performance.timing&&performance.timing.navigationStart&&(a=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-a}}}(),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();
var TYPE6={Revision:"0.2.3"};TYPE6.MathUtils={round:function(a,b){return b=Math.pow(10,b),Math.round(a*b)/b},floor:function(a,b){return b=Math.pow(10,b),Math.floor(a*b)/b},ceil:function(a,b){return b=Math.pow(10,b),Math.ceil(a*b)/b},trunc:function(a,b){return b=Math.pow(10,b),Math.trunc(a*b)/b},roundToNearest:function(a,b){return Math.round(a/b)*b},isEven:function(a){return!(1&a)},isOdd:function(a){return 1&a},mix:function(a,b,c){return(1-c)*a+c*b},getSign:function(a){return a?0>a?-1:1:0},getOppositeSign:function(a){return-a},clamp:function(a,b,c){return Math.min(Math.max(a,b),c)},normalize:function(a,b,c){return(a-b)/(c-b)},lerp:function(a,b,c){return(c-b)*a+b},map:function(a,b,c,d,e){return this.lerp(this.normalize(a,b,c),d,e)}},TYPE6.Random={"float":function(a,b){return a+Math.random()*(b-a)},integer:function(a,b){return Math.floor(a+Math.random()*(b-a+1))},distribution:function(a,b,c){for(var d=0,e=0;c>e;e++)d+=this["float"](a,b);return d/c},pick:function(a,b){return Math.random()<.5?a:b}},TYPE6.Bezier={quadratic:function(a,b,c,d,e,f,g,h){return g*a+h*b+e*c},cubic:function(a,b,c,d,e,f,g){return Math.pow(g,3)*a+3*Math.pow(g,2)*e*b+3*g*f*c+f*e*d}},TYPE6.Vector2D={x:0,y:0,create:function(a,b){var c=Object.create(this);return c.setX(a),c.setY(b),c},createFromArray:function(a){var b=Object.create(this);return b.setX(a[0]),b.setY(a[1]),b},toArray:function(){return[this.x,this.y]},toString:function(){return"("+this.x+";"+this.y+")"},setX:function(a){return this.x=this.valueValidation(a),this.x},getX:function(){return this.x},setY:function(a){return this.y=this.valueValidation(a),this.y},getY:function(){return this.y},set:function(a,b){return this.hasOwnProperty(a)?(this[a]=this.valueValidation(b),this[a]):!1},get:function(a){return this.hasOwnProperty(a)?this[a]:!1},setXY:function(a,b){this.x=this.valueValidation(a),this.y=this.valueValidation(b)},setToOrigin:function(){this.x=0,this.y=0},setXToOrigin:function(){this.x=0},setYToOrigin:function(){this.y=0},setAngle:function(a){if(this.valueValidation(a)){var b=this.getMagnitude();return this.x=TYPE6.Trigonometry.cosinus(a)*b,this.y=TYPE6.Trigonometry.sinus(a)*b,!0}return!1},getAngle:function(){return Math.atan2(this.y,this.x)},setMagnitude:function(a){if(this.valueValidation(a)){var b=this.getAngle();return this.x=TYPE6.Trigonometry.cosinus(b)*a,this.y=TYPE6.Trigonometry.sinus(b)*a,!0}return!1},getMagnitude:function(){return Math.sqrt(this.getSquaredMagnitude())},getSquaredMagnitude:function(){return this.x*this.x+this.y*this.y},getDistance:function(a){this.subtractFrom(a);var b=this.getMagnitude();return this.addTo(a),b},getSquaredDistance:function(a){this.subtractFrom(a);var b=this.getSquaredMagnitude();return this.addTo(a),b},copy:function(){return this.create(this.getX(),this.getY())},add:function(a){return this.create(this.x+a.getX(),this.y+a.getY())},addX:function(a){return this.create(this.x+a,this.y)},addY:function(a){return this.create(this.x,this.y+a)},addScalar:function(a){return this.create(this.x+a,this.y+a)},addScaledVector:function(a,b){return this.create(this.x+a.getX()*b,this.y+a.getY()*b)},subtract:function(a){return this.create(this.x-a.getX(),this.y-a.getY())},subtractScalar:function(a){return this.create(this.x-a,this.y-a)},subtractScaledVector:function(a,b){return this.create(this.x-a.getX()*b,this.y-a.getY()*b)},scale:function(a){return this.create(this.x*a,this.y*a)},multiply:function(a){return this.create(this.x*a.getX(),this.y*a.getY())},divide:function(a){return this.create(this.x/a.getX(),this.y/a.getY())},halve:function(){return this.create(.5*this.x,.5*this.y)},normalize:function(){var a=this.getMagnitude();return a?this.scale(1/a):void 0},absolute:function(){return this.create(Math.abs(this.x),Math.abs(this.y))},opposite:function(){return this.create(-this.x,-this.y)},oppositeX:function(){return this.create(-this.x,this.y)},oppositeY:function(){return this.create(this.x,-this.y)},clamp:function(a){return this.create(TYPE6.MathUtils.clamp(this.x,a.topLeftCorner.getX(),a.bottomRightCorner.getX()),TYPE6.MathUtils.clamp(this.y,a.topLeftCorner.getY(),a.bottomRightCorner.getY()))},lerp:function(a,b,c){return this.create(TYPE6.MathUtils.lerp(a,b.getX(),c.getX()),TYPE6.MathUtils.lerp(a,b.getY(),c.getY()))},quadraticBezier:function(a,b,c,d){var e=d*d,f=1-d,g=Math.pow(f,2),h=2*f*d;return this.create(TYPE6.Bezier.quadratic(a.getX(),b.getX(),c.getX(),d,e,f,g,h),TYPE6.Bezier.quadratic(a.getY(),b.getY(),c.getY(),d,e,f,g,h))},cubicBezier:function(a,b,c,d,e){var f=e*e,g=1-e;return this.create(TYPE6.Bezier.cubic(a.getX(),b.getX(),c.getX(),d.getX(),e,f,g),TYPE6.Bezier.cubic(a.getY(),b.getY(),c.getY(),d.getY(),e,f,g))},quadraticBezierTo:function(a,b,c,d){var e=d*d,f=1-d,g=Math.pow(f,2),h=2*f*d;this.x=TYPE6.Bezier.quadratic(a.getX(),b.getX(),c.getX(),d,e,f,g,h),this.y=TYPE6.Bezier.quadratic(a.getY(),b.getY(),c.getY(),d,e,f,g,h)},cubicBezierTo:function(a,b,c,d,e){var f=e*e,g=1-e;this.x=TYPE6.Bezier.cubic(a.getX(),b.getX(),c.getX(),d.getX(),e,f,g),this.y=TYPE6.Bezier.cubic(a.getY(),b.getY(),c.getY(),d.getY(),e,f,g)},copyTo:function(a){this.x=a.getX(),this.y=a.getY()},addTo:function(a){this.x+=a.getX(),this.y+=a.getY()},addToX:function(a){this.x+=a},addToY:function(a){this.y+=a},addScalarTo:function(a){this.x+=a,this.y+=a},addScaledVectorTo:function(a,b){this.x+=a.getX()*b,this.y+=a.getY()*b},copyScaledVectorTo:function(a,b){this.x=a.getX()*b,this.y=a.getY()*b},subtractFrom:function(a){this.x-=a.getX(),this.y-=a.getY()},copySubtractFromTo:function(a,b){this.x=a.getX()-b.getX(),this.y=a.getY()-b.getY()},subtractScalarFrom:function(a){this.x-=a,this.y-=a},subtractScaledVectorFrom:function(a,b){this.x-=a.getX()*b,this.y-=a.getY()*b},scaleBy:function(a){this.x*=a,this.y*=a},multiplyBy:function(a){this.x*=a.getX(),this.y*=a.getY()},divideBy:function(a){this.x/=a.getX(),this.y/=a.getY()},halveBy:function(){this.x*=.5,this.y*=.5},normalizeTo:function(){var a=this.getMagnitude();a&&this.scaleBy(1/a)},absoluteTo:function(){this.x=Math.abs(this.x),this.y=Math.abs(this.y)},oppositeTo:function(){this.x=-this.x,this.y=-this.y},oppositeXTo:function(){this.x=-this.x},oppositeYTo:function(){this.y=-this.y},clampTo:function(a){this.x=TYPE6.MathUtils.clamp(this.x,a.topLeftCorner.getX(),a.bottomRightCorner.getX()),this.y=TYPE6.MathUtils.clamp(this.y,a.topLeftCorner.getY(),a.bottomRightCorner.getY())},lerpTo:function(a,b,c){this.x=TYPE6.MathUtils.lerp(a,b.getX(),c.getX()),this.y=TYPE6.MathUtils.lerp(a,b.getY(),c.getY())},dotProduct:function(a){return this.x*a.getX()+this.y*a.getY()},isOrigin:function(){return 0===this.x||0===this.y},isPositive:function(){return this.getX()>0&&this.getY()>0},isNegative:function(){return this.getX()<0&&this.getY()<0},isNotOrigin:function(){return!(!this.x&&!this.y)},valueValidation:function(a){return isNaN(a)?0:a}},TYPE6.Geometry={},TYPE6.Geometry.Circle={position:{},radius:0,diameter:0,shape:"circle",size:{},halfSize:{},create:function(a,b,c){var d=Object.create(this);return d.init(),d.setRadius(c),d.initSize(),d.setPositionXY(a,b),d},init:function(){this.position=TYPE6.Vector2D.create(),this.radius=0,this.diameter=0},initSize:function(){this.size=TYPE6.Vector2D.create(this.diameter,this.diameter),this.halfSize=TYPE6.Vector2D.create(this.radius,this.radius)},copy:function(a){return this.create(a.getPositionX(),a.getPositionY(),a.getRadius())},copyTo:function(a){this.setPositionFromVector2D(a.getPosition()),this.setRadius(a.getRadius())},setPositionX:function(a){return this.position.setX(a),this.position.getX()},setPositionY:function(a){return this.position.setY(a),this.position.getY()},setPositionXY:function(a,b){return this.position.setXY(a,b),this.position},setPositionFromVector2D:function(a){return this.position.copyTo(a),this.position},getPosition:function(){return this.position},getPositionX:function(){return this.position.getX()},getPositionY:function(){return this.position.getY()},setRadius:function(a){return this.radius=a,this.diameter=2*this.radius,this.initSize(),this.radius},getRadius:function(){return this.radius},setDiameter:function(a){return this.diameter=a,this.radius=.5*this.diameter,this.initSize(),this.diameter},getDiameter:function(){return this.diameter},getHalfSize:function(){return this.halfSize},clampTo:function(a){this.position.clampTo(a)},scale:function(a){return this.create(this.position.getX(),this.position.getY(),this.radius*a)},scaleBy:function(a){return this.setRadius(this.radius*a),this.radius},getDistance:function(a){return this.position.getDistance(a)},getSquaredDistance:function(a){return this.position.getSquaredDistance(a)},draw:function(a,b){a.fillStyle=b,a.beginPath(),a.arc(this.getPositionX(),this.getPositionY(),this.getRadius(),0,TYPE6.Trigonometry.TWOPI,!1),a.fill()}},TYPE6.Geometry.Rectangle={position:{},topLeftCorner:{},bottomRightCorner:{},size:{},halfSize:{},shape:"aabb",create:function(a,b,c,d){var e=Object.create(this);return e.initSize(c,d),e.initPosition(a,b),e},initSize:function(a,b){this.size=TYPE6.Vector2D.create(a,b),this.halfSize=this.size.halve()},initPosition:function(a,b){this.position=TYPE6.Vector2D.create(a,b),this.topLeftCorner=TYPE6.Vector2D.create(a-this.halfSize.getX(),b-this.halfSize.getY()),this.bottomRightCorner=TYPE6.Vector2D.create(a+this.halfSize.getX(),b+this.halfSize.getY())},copy:function(a){return this.create(a.getPositionX(),a.getPositionY(),a.getSizeX(),a.getSizeY())},copyTo:function(a){this.setSizeFromVector2D(a.getSize()),this.setPositionFromVector2D(a.getPosition())},setPositionXY:function(a,b){return this.position.setXY(a,b),this.setTopLeftCornerXY(a-this.getHalfSizeX(),b-this.getHalfSizeY()),this.setBottomRightCornerXY(a+this.getHalfSizeX(),b+this.getHalfSizeY()),this.position},setPositionFromVector2D:function(a){return this.position.copyTo(a),this.setTopLeftCornerXY(a.getX()-this.getHalfSizeX(),a.getY()-this.getHalfSizeY()),this.setBottomRightCornerXY(a.getX()+this.getHalfSizeX(),a.getY()+this.getHalfSizeY()),this.position},setTopLeftCornerXY:function(a,b){return this.topLeftCorner.setXY(a,b),this.topLeftCorner},setTopLeftCornerFromVector2D:function(a){return this.topLeftCorner.copyTo(a),this.topLeftCorner},setBottomRightCornerXY:function(a,b){return this.bottomRightCorner.setXY(a,b),this.bottomRightCorner},setBottomRightCornerFromVector2D:function(a){return this.bottomRightCorner.copyTo(a),this.bottomRightCorner},getPosition:function(){return this.position},getPositionX:function(){return this.position.getX()},getPositionY:function(){return this.position.getY()},getTopLeftCorner:function(){return this.topLeftCorner},getTopLeftCornerX:function(){return this.topLeftCorner.getX()},getTopLeftCornerY:function(){return this.topLeftCorner.getY()},getBottomRightCorner:function(){return this.bottomRightCorner},getBottomRightCornerX:function(){return this.bottomRightCorner.getX()},getBottomRightCornerY:function(){return this.bottomRightCorner.getY()},setSizeXY:function(a,b){return this.size.setXY(a,b),this.size},setSizeFromVector2D:function(a){return this.size.copyTo(a),this.size},getSize:function(){return this.size},getSizeX:function(){return this.size.getX()},getSizeY:function(){return this.size.getY()},getHalfSize:function(){return this.halfSize},getHalfSizeX:function(){return this.halfSize.getX()},getHalfSizeY:function(){return this.halfSize.getY()},draw:function(a,b){a.fillStyle=b,a.fillRect(this.topLeftCorner.getX(),this.topLeftCorner.getY(),this.size.getX(),this.size.getY())}},TYPE6.Trigonometry={PI:TYPE6.MathUtils.round(Math.PI,2),TWOPI:TYPE6.MathUtils.round(2*Math.PI,2),HALFPI:TYPE6.MathUtils.round(.5*Math.PI,2),sineDecimals:2,cosineDecimals:2,arctanDecimals:2,factorialArray:[],sineLoops:{0:9,1:11,2:13,3:15,4:17,5:18,6:19,7:21,8:23},cosineLoops:{0:6,1:8,2:10,3:12,4:14,5:16,6:18,7:20,8:22},arctanLoops:{0:17,1:19,2:21,3:23,4:25,5:27,6:29,7:31,8:33},setSinePrecision:function(a){return this.sineLoops.hasOwnProperty(property)?(this.sineDecimals=a,a):(this.sineDecimals=2,2)},setCosinePrecision:function(a){return this.cosineLoops.hasOwnProperty(property)?(this.cosineDecimals=a,a):(this.cosineDecimals=2,2)},degreeToRadian:function(a){return a*this.PI/180},radianToDegree:function(a){return 180*a/this.PI},sine:function(a){return a=this.normalizeRadian(a),this.sineDecimals<=2&&.28>a&&a>-.28?a:this.taylorSerie(3,this.sineLoops[this.sineDecimals],a,a,!0)},cosine:function(a){a=this.normalizeRadian(a);var b=a*a;return this.cosineDecimals<=2&&.5>=a&&a>=-.5?1-.5*b:this.taylorSerie(2,this.cosineLoops[this.cosineDecimals],1,a,!0)},arctan2:function(a,b){var c=b/a;return a>0?this.arctan(c):0>a?0>b?this.arctan(c)-this.PI:this.arctan(c)+this.PI:0>b?-this.HALFPI:b>0?this.HALFPI:!1},arctan2fromVector2D:function(a){return this.arctan2(a.getX(),a.getY())},arctan:function(a){var b=this.arctanLoops[this.arctanDecimals];return 1>a&&a>-1?this.taylorSerie(3,b,a,a,!1):a>=1?(a=1/a,-(this.taylorSerie(3,b,a,a,!1)-this.HALFPI)):(a=-1/a,this.taylorSerie(3,b,a,a,!1)-this.HALFPI)},sineEquation:function(a,b,c,d){return a*this.sine(b+c)+d},cosineEquation:function(a,b,c,d){return a*this.cosine(b+c)+d},arctanEquation:function(a,b,c,d){return a*this.arctan(b+c)+d},taylorSerie:function(a,b,c,d,e){for(var f=d*d,g=c,h=0,i=-1,j=0;b>=a;a+=2,j++)c*=f,h=e?this.factorialArray[a]:a,g+=c/h*i,i=TYPE6.MathUtils.getOppositeSign(i);return g},createFactorialArray:function(){for(var a=1,b=1;a<=Math.max(3*this.sineLoops[8],2*this.cosineLoops[8]);a++)b*=this.factorial(a),this.factorialArray.push(b)},factorial:function(a){return a>1?a-1:1},normalizeRadian:function(a){return a>this.PI||a<-this.PI?a-this.TWOPI*Math.floor((a+this.PI)/this.TWOPI):a}},TYPE6.Trigonometry.createFactorialArray();
var TAIPAN={revision:"0.2.1",create:function(a){var b=Object.create(this);return b.config=a,b.status=TAIPAN.States.create(b.config),b.createEvents(),b},createEvents:function(){for(var a=0;a<this.config.length;a++){var b=this.config[a];this.hasOwnProperty(b.name)||(this[b.name]=this.setStatus(b.from,b.to))}},getStatus:function(){for(var a in this.status)if(this.status[a]===!0)return a;return!1},setStatus:function(a,b){return function(){return this.status[a]===!0&&(this.status[a]=!1,this.status[b]=!0,!0)}}};TAIPAN.States={create:function(a){for(var b=Object.create(this),c=0;c<a.length;c++){var d=a[c];this.hasOwnProperty(d.from)||(this[d.from]=!c),this.hasOwnProperty(d.to)||(this[d.to]=!1)}return b}};